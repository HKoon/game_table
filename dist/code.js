!function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(n){return e[n]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=12)}({12:function(e,n){var t=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,l){function a(e){try{c(i.next(e))}catch(e){l(e)}}function r(e){try{c(i.throw(e))}catch(e){l(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,r)}c((i=i.apply(e,n||[])).next())}))};function i(e,n,t){const i=e[n];e[n]=e[t],e[t]=i}function o(e,n){for(let t=n;t<e.length;t++){i(e,t,t+Math.floor(Math.random()*(e.length-t)))}}function l(e){"GROUP"===e.type&&e.children.length>0&&"FRAME"===e.children[0].type&&3===(e=e.children[0]).children.length&&e.children[2].remove()}const a=figma.currentPage.selection;if(1!==a.length||"Catan Game Board"!==a[0].name&&"reset_catan"!==figma.command||"FRAME"!==a[0].type)if(figma.command&&""!==figma.command&&"reset"!==figma.command){const e=figma.currentPage.selection;""!==figma.root.getPluginData("url")||e.length>0&&""!==e[0].getPluginData("assetNode")?(figma.showUI(__html__,{width:400,height:400}),figma.ui.postMessage({type:"warn"})):"shuffle"===figma.command?function(){const e=figma.currentPage.selection.map(e=>e.id);if(0===e.length)return;const n=figma.getNodeById(e[0]),t=n.parent;let i=n.x,o=n.y;for(let n=0;n<e.length;n++){const a=Math.floor(Math.random()*(e.length-n))+n,r=figma.getNodeById(e[a]);l(r),r.x=i,r.y=o,o--,t.insertChild(n,r);const c=e[a];e[a]=e[n],e[n]=c}figma.notify("Finished shuffling"),figma.closePlugin()}():"flip"===figma.command?function(){const e=figma.currentPage.selection;for(let n of e)if("GROUP"===n.type&&0!==n.children.length&&"FRAME"===n.children[0].type)if(n.parent.appendChild(n),n=n.children[0],2===n.children.length){const e=n.children[0].clone();n.appendChild(e)}else 3===n.children.length&&n.children[2].remove();figma.closePlugin()}():"gather"===figma.command||"tidy"===figma.command?(!function(){const e=[...figma.currentPage.selection];if(0===e.length)return void figma.notify("Select item or itmes to gather");let n=e[0],t=n.x,i=n.y;const o=n.parent;if(o.removed)return;if("FRAME"!==o.type&&"PAGE"!==o.type)return;if(e.length>1){e.sort((e,n)=>e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0),n=e[0],t=n.x,i=n.y;for(const n of e)n.x=t,n.y=i,t+=n.width+2,o.appendChild(n);return}const a=n.getPluginData("class"),r=o.children,c=[];for(const e of r)e.getPluginData("class")===a&&(c.push(e),l(e),e.x=t,e.y=i,i--);figma.currentPage.selection=c}(),figma.closePlugin()):"show"===figma.command?function(){figma.showUI(__html__,{width:400,height:400});let e={};const n=()=>t(this,void 0,void 0,(function*(){const n=figma.currentPage.selection;let t=!0;for(const i of n)e[i.id]!==`${i.x}:${i.y}`&&(e[i.id]=`${i.x}:${i.y}`,t=!1);if(t)return;const i=figma.createFrame();i.clipsContent=!1,i.x=-1e8;for(const e of n)if("GROUP"===e.type&&""!==e.getPluginData("gameId")){if(0===e.children.length||"FRAME"!==e.children[0].type)continue;const n=e.children[0],t=n.children[0].clone();i.appendChild(t),t.x=n.absoluteTransform[0][2],t.y=n.absoluteTransform[1][2]}let o=null;if(i.children.length>0){const e=figma.group(i.children,i);yield new Promise(e=>setTimeout(e,100)),o=(yield e.exportAsync({format:"PNG",contentsOnly:!1})).reduce((e,n)=>e+String.fromCharCode(n),"")}figma.ui.postMessage({type:"img",uri:o}),i.remove()}));n(),figma.ui.on("message",e=>{"trigger-refresh"===e.type&&n()}),figma.on("selectionchange",()=>{e={},n()})}():"count"===figma.command&&(figma.notify(`${figma.currentPage.selection.length} selected`),figma.closePlugin())}else!function(){const e=figma.currentPage.selection;if(1!==e.length)return figma.notify("Select exactly 1 frame to start game"),void figma.closePlugin();let n=e[0];if("FRAME"!==n.type)return figma.notify("Must select a frame node"),void figma.closePlugin();n.setRelaunchData({reset:"Reset the game to the default state"}),figma.root.setPluginData("url","");for(const e of n.children)(e.getPluginData("gameId")===n.id||"assets"===e.name&&"COMPONENT"===e.type)&&e.remove();let t=0;for(const e of figma.root.children)if("Assets"===e.name){let i=100;for(const o of e.children){if("FRAME"!==o.type)continue;t++;let e=null,l=100;for(const a of o.children)if(null===e)e=a;else{if("COMPONENT"===a.type)continue;{const r=e.clone();r.x=0,r.y=0,r.locked=!0;const c=a.clone();c.x=0,c.y=0,c.locked=!0;const f=figma.createFrame();n.appendChild(f),f.name=o.name,f.fills=[],f.clipsContent=!1,f.appendChild(c),f.appendChild(r),f.resize(c.width,c.height),f.x=i,f.y=l;const s=figma.createRectangle();n.appendChild(s),s.name="----",s.resize(c.width,1),s.x=f.x,s.y=f.y+f.height,s.fills=[];const u=figma.group([f,s],n);u.name=o.name,u.setPluginData("gameId",n.id),u.setPluginData("class",`item-${t}`),u.setRelaunchData({shuffle:"",gather:"",flip:"",tidy:"",show:"Only you see the hidden info",count:`Count ${o.name}s`}),l--}}e&&(i+=100+e.width)}}figma.closePlugin()}();else a[0].setRelaunchData({reset_catan:""}),function(e){const n=[[2,4],[2,6],[3,5],[3,3],[2,2],[1,3],[1,5],[2,8],[3,7],[4,6],[4,4],[4,2],[3,1],[2,0],[1,1],[0,2],[0,4],[0,6],[1,7]].reverse(),t={};for(let e=0;e<n.length;e++){t[`${n[e]}`]=e}const l=["Field","Forest","Ore","Desert","Wheat","Clay"],a=[0,0,0,0,1,1,1,1,2,2,2,3,4,4,4,4,5,5,5],r=[null,null,null,null,null,null];let c=0;const f=["Field","Forest","Ore","Any","Wheat","Clay"],s=[0,1,2,3,3,3,3,4,5],u=[null,null,null,null,null,null];let g=0;const m=["2","3","4","5","6","8","9","10","11","12"],d=[0,1,1,2,2,3,3,6,6,7,7,8,8,9],h=[null,null,null,null,null,null,null,null,null,null];let p=0;for(const e of figma.root.children)if(!(e.name.indexOf("Components")<0)){for(const n of e.children)if("COMPONENT"===n.type){if(0===n.name.indexOf("Biome / ")){const e=n.name.substring(8),t=l.indexOf(e);if(t<0)continue;if(null!=r[t])continue;c++,r[t]=n}else if(0===n.name.indexOf("Port / ")){const e=n.name.substring(7),t=f.indexOf(e);if(t<0)continue;if(null!=u[t])continue;g++,u[t]=n}else if(0===n.name.indexOf("Number Tile / ")){const e=n.name.substring(14),t=m.indexOf(e);if(t<0)continue;if(null!=h[t])continue;p++,h[t]=n}if(6===c&&6===g&&10===p)break}if(6===c&&6===g&&10===p)break}o(a,0),o(s,0);let y=0,P=0;const x=[];for(let e=0;e<a.length;e++)3!==a[e]&&x.push(e);const O=[4,4,5,5];let C=0;for(let e=0;e<4;e++){const o=O[e];d.splice(C,0,o),i(x,C,Math.floor(Math.random()*(x.length-C))+C);const l=n[x[C]];C++;const a=[[l[0]-1,l[1]-1],[l[0]-1,l[1]+1],[l[0],l[1]-2],[l[0],l[1]+2],[l[0]+1,l[1]-1],[l[0]+1,l[1]+1]];for(const e of a){const n=t[`${e}`];if(null==n)continue;const o=x.indexOf(n);o<C||(i(x,C,o),i(d,C,C+Math.floor(Math.random()*(d.length-C))),C++)}}o(d,C);const M={};for(let e=0;e<d.length;e++)M[x[e]]=h[d[e]];for(const n of e.children)"INSTANCE"===n.type&&(0===n.name.indexOf("Biome / ")&&(n.masterComponent=r[a[y]],M[y]&&"INSTANCE"===n.children[1].type&&(n.children[1].masterComponent=M[y]),y++),0===n.name.indexOf("Port / ")&&(n.masterComponent=u[s[P]],P++));figma.closePlugin()}(a[0])}});