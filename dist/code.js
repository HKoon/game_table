!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}({11:function(e,t){function n(e){if("INSTANCE"===e.type){const t=e.masterComponent;3===t.children.length&&t.children[2].remove()}}function i(){const e=[...figma.currentPage.selection];if(0===e.length)return void figma.notify("Select item or itmes to gather");let t=e[0],i=t.x,o=t.y;const a=t.getPluginData("assetNode");if(""===a)return;const r=figma.getNodeById(a);if(r.removed)return;if("COMPONENT"!==r.type)return;if(e.length>1){e.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),t=e[0],i=t.x,o=t.y;for(const t of e)t.x=i,t.y=o,i+=t.width+2,r.appendChild(t);return void figma.closePlugin()}const l=t.name,f=r.children,c=[];for(const e of f)e.name===l&&(c.push(e),n(e),e.x=i,e.y=o,o--);figma.currentPage.selection=c,figma.closePlugin()}"shuffle"===figma.command?function(){const e=figma.currentPage.selection.map(e=>e.id);if(0===e.length)return;const t=figma.getNodeById(e[0]),i=t.parent;let o=t.x,a=t.y;for(let t=0;t<e.length;t++){const r=Math.floor(Math.random()*(e.length-t))+t,l=figma.getNodeById(e[r]);n(l),l.x=o,l.y=a,a--,i.insertChild(t,l);const f=e[r];e[r]=e[t],e[t]=f}figma.notify("Finished shuffling"),figma.closePlugin()}():"flip"===figma.command?function(){const e=figma.currentPage.selection;for(let t of e)if("INSTANCE"===t.type)if(t=t.masterComponent,2===t.children.length){const e=t.children[1].clone();t.appendChild(e),e.y=0}else 3===t.children.length&&t.children[2].remove();figma.closePlugin()}():"gather"===figma.command||"tidy"===figma.command?i():"count"===figma.command?(figma.notify(`${figma.currentPage.selection.length} selected`),figma.closePlugin()):function(){figma.showUI(__html__,{width:400,height:150});const e=figma.currentPage.selection;if(1!==e.length)return figma.notify("Select exactly 1 frame to start game"),void figma.closePlugin();const t=figma.root.getPluginData("url");null!==t&&figma.ui.postMessage({type:"setURL",url:t});let n=e[0];if(""!==n.getPluginData("gameRef")){const e=figma.getNodeById(n.getPluginData("gameRef"));e&&!e.removed&&(n=e)}if("FRAME"!==n.type)return figma.notify("Must select a frame node"),void figma.closePlugin();let i=null;n.setRelaunchData({players:"Select or create a Viewing Window to see secret info"});for(const e of n.children)"COMPONENT"===e.type&&"assets"===e.name&&(i=e,n.insertChild(n.children.length-1,e));for(const e of figma.root.children){const t=e.getPluginData("srcNode");if(t){const n=figma.getNodeById(t);n&&!n.removed||e.remove()}else if("Assets"===e.name&&null===i){i=figma.createComponent(),i.name="assets",n.appendChild(i);const t=n.getPluginData("hiddenNode");""!==t&&figma.getNodeById(t).remove();const o=figma.createFrame();o.name="hidden-data",o.visible=!1,o.locked=!0,n.setPluginData("hiddenNode",o.id);let a=100;for(const t of e.children){if("FRAME"!==t.type)continue;let e=null,n=100;for(const r of t.children)if(null===e)e=r;else{if("COMPONENT"===r.type)continue;{const l=figma.createComponent(),f=e.clone();f.x=0,f.y=0,f.locked=!0,l.name=t.name,l.clipsContent=!1,o.appendChild(l),l.appendChild(f);const c=r.clone();l.appendChild(c),c.x=0,c.y=2e4,c.locked=!0,l.resize(c.width,c.height),l.setRelaunchData({shuffle:"",gather:"",flip:"",tidy:"",count:`Count ${t.name}s`});const s=l.createInstance();s.setPluginData("assetNode",i.id),i.appendChild(s),s.x=a,s.y=n,n--}}e&&(a+=100+e.width)}}}function o(){function e(){figma.ui.postMessage({type:"unsetViewerFrame"}),figma.ui.resize(400,150)}if(1!==figma.currentPage.selection.length)return void e();const t=figma.currentPage.selection[0];t.parent===i?function(e){const t=e.getPluginData("viewerRef"),n=figma.getNodeById(t);figma.ui.resize(400,n?400:150),figma.ui.postMessage({type:"setViewerFrame",viewerFrame:n?t:null})}(t):e()}i.resize(n.width,n.height+2e4),i.x=0,i.y=0,figma.on("selectionchange",o),o(),figma.ui.onmessage=e=>{if("setURL"===e.type)figma.root.setPluginData("url",e.url);else if("setViewerFrame"===e.type){if(1!==figma.currentPage.selection.length)return;const e=figma.currentPage.selection[0],t=e.getPluginData("viewerRef");if(figma.getNodeById(t))return;if("RECTANGLE"!==e.type&&"FRAME"!==e.type&&"INSTANCE"!==e.type)return;e.fills=[],e.strokes=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:.5},{type:"SOLID",color:{r:1,g:1,b:1},opacity:.5}],e.locked=!0,e.dashPattern=[32,32],e.strokeWeight=8,e.name="Viewing Window";const o=figma.createPage();o.name="viewer-page",o.setPluginData("srcNode",e.id);const a=figma.createFrame();o.appendChild(a),a.name="viewer",e.setPluginData("viewerRef",a.id),e.setPluginData("gameRef",n.id),e.setRelaunchData({players:"Get link to secret viewing window"}),a.resize(e.width,e.height);const r=i.createInstance();a.appendChild(r),r.x=i.x-e.x,r.y=i.y-e.y-2e4,figma.ui.resize(400,400),figma.ui.postMessage({type:"setViewerFrame",viewerFrame:a.id})}}}()}});